<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aspierrow Data GH</title>

<script src="https://js.paystack.co/v1/inline.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
header{background:#0d6efd;color:#fff;padding:15px;text-align:center}
.container{max-width:700px;margin:auto;padding:15px}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
button{padding:10px;border:none;border-radius:6px;cursor:pointer}
.primary{background:#0d6efd;color:#fff}
.success{background:#198754;color:#fff}
.warning{background:#ffc107;color:#000}
.danger{background:#dc3545;color:#fff}
input,select{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc}
.hidden{display:none}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #ddd;font-size:14px}
.status{padding:4px 8px;border-radius:6px;font-size:12px}
.DELIVERED{background:#198754;color:#fff}
.PENDING{background:#ffc107;color:#000}
</style>
</head>

<body>

<header>
<h2>Aspierrow Data GH</h2>
<small>Affordable â€¢ Fast â€¢ Reliable</small>
</header>

<div class="container">

<!-- LANDING -->
<div class="card" id="landing">
<button class="primary" onclick="showCustomer()">Buy Data</button><br><br>
<button class="success" onclick="showLogin()">Agent / Admin Login</button>
</div>

<!-- CUSTOMER -->
<div class="card hidden" id="customer">
<h3>Buy Data</h3>
<select id="cNet">
<option value="">Select Network</option>
<option>MTN</option><option>Telecel</option><option>AirtelTigo</option>
</select>
<input id="cPhone" placeholder="Beneficiary Number">
<input id="cData" placeholder="Data (GB)">
<button class="primary" onclick="customerPay()">Pay & Order</button>
<button class="danger" onclick="back()">Back</button>
</div>

<!-- LOGIN -->
<div class="card hidden" id="login">
<h3>Login</h3>
<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Password">
<button class="primary" onclick="login()">Login</button>
<button class="danger" onclick="back()">Back</button>
</div>

<!-- DASHBOARD -->
<div class="card hidden" id="dashboard">
<h3 id="roleTitle"></h3>

<button class="success hidden" id="exportBtn" onclick="exportExcel()">ðŸ“¤ Export Excel</button>

<h4>Orders</h4>
<table>
<thead>
<tr>
<th>Network</th><th>Phone</th><th>Data</th><th>Status</th><th>Action</th>
</tr>
</thead>
<tbody id="orders"></tbody>
</table>

<!-- ADMIN SETTINGS -->
<div class="card hidden" id="adminSettings">
  <h3>Admin Settings</h3>

  <h4>Set Data Prices (GHS per GB)</h4>
  <input id="priceMTN" placeholder="MTN Price">
  <input id="priceTelecel" placeholder="Telecel Price">
  <input id="priceAirtelTigo" placeholder="AirtelTigo Price">
  <button class="success" onclick="savePrices()">Save Prices</button>

  <h4>AFA Registration Fee (GHS)</h4>
  <input id="afaFee" placeholder="AFA Fee" value="20" disabled>
  <small>AFA fee is fixed at 20 GHS for all customers and agents</small>
</div>

<button class="danger" onclick="logout()">Logout</button>
</div>

</div>

<script>
// DOM Elements
const landing = document.getElementById("landing");
const customer = document.getElementById("customer");
const login = document.getElementById("login");
const dashboard = document.getElementById("dashboard");
const ordersEl = document.getElementById("orders");
const roleTitle = document.getElementById("roleTitle");
const exportBtn = document.getElementById("exportBtn");
const adminSettings = document.getElementById("adminSettings");
const cNet = document.getElementById("cNet");
const cPhone = document.getElementById("cPhone");
const cData = document.getElementById("cData");
const email = document.getElementById("email");
const pass = document.getElementById("pass");
const priceMTN = document.getElementById("priceMTN");
const priceTelecel = document.getElementById("priceTelecel");
const priceAirtelTigo = document.getElementById("priceAirtelTigo");
const afaFeeInput = document.getElementById("afaFee");

// Admin credentials
const ADMIN_EMAIL="admin@aspierrowdata.com";
const ADMIN_PASS="admin123";
let currentUser=null;

// Default Prices
let prices = JSON.parse(localStorage.getItem("dataPrices")) || {MTN:5, Telecel:5, AirtelTigo:5};
let afaFee = 20; // Fixed AFA fee

// Initialize admin price inputs
priceMTN.value = prices.MTN;
priceTelecel.value = prices.Telecel;
priceAirtelTigo.value = prices.AirtelTigo;

// Show / Hide Sections
function showCustomer(){hideAll();customer.classList.remove("hidden")}
function showLogin(){hideAll();login.classList.remove("hidden")}
function back(){hideAll();landing.classList.remove("hidden")}
function hideAll(){
  landing.classList.add("hidden");
  customer.classList.add("hidden");
  login.classList.add("hidden");
  dashboard.classList.add("hidden");
  adminSettings.classList.add("hidden");
}

// Customer Payment
function customerPay(){
  let net=cNet.value, phone=cPhone.value, data=cData.value;
  if(!net||!phone||!data) return alert("Fill all fields");
  
  let pricePerGB = prices[net] || 5;
  let amount = data*pricePerGB + afaFee; // Add 20 GHS AFA

  PaystackPop.setup({
    key:"pk_live_9a302e6eefda024c28eb3bc1db61db510e38285e",
    email:"guest@site.com",
    amount:amount*100,
    currency:"GHS",
    callback:()=>{
      saveOrder("Guest",net,phone,data,"paystack");
      alert(`Order placed. AFA Registration of 20 GHS applied.`);
      back();
    }
  }).openIframe();
}

// Login
function login(){
  let e=email.value,p=pass.value;
  if(e===ADMIN_EMAIL && p===ADMIN_PASS){
    currentUser={role:"admin"};
  } else {
    currentUser={role:"agent"};
  }
  loadDashboard();
}

// Load Dashboard
function loadDashboard(){
  hideAll();
  dashboard.classList.remove("hidden");
  roleTitle.innerText=currentUser.role.toUpperCase()+" DASHBOARD";
  if(currentUser.role==="admin"){
    exportBtn.classList.remove("hidden");
    adminSettings.classList.remove("hidden");
  }
  loadOrders();
}

// Orders Management
function saveOrder(user,net,phone,data,payment){
  let orders=JSON.parse(localStorage.getItem("orders"))||[];
  orders.push({
    user,network:net,phone,data,
    status:"PENDING",
    payment,
    date:new Date().toLocaleString()
  });
  localStorage.setItem("orders",JSON.stringify(orders));
  window.open(`https://wa.me/233591467262?text=NEW ORDER%0ANetwork:${net}%0APhone:${phone}%0AData:${data}GB%0AAFA:20GHS`);
}

function loadOrders(){
  let orders=JSON.parse(localStorage.getItem("orders"))||[];
  let ordersHtml="";
  orders.forEach((o,i)=>{
    ordersHtml+=`
<tr>
<td>${o.network}</td>
<td>${o.phone}</td>
<td>${o.data}GB</td>
<td><span class="status ${o.status}">${o.status}</span></td>
<td>${currentUser.role==="admin"?`<button class="warning" onclick="toggleStatus(${i})">Toggle</button>`:"-"}</td>
</tr>`;
  });
  ordersEl.innerHTML=ordersHtml;
}

function toggleStatus(i){
  let orders=JSON.parse(localStorage.getItem("orders"));
  orders[i].status = orders[i].status==="DELIVERED"?"PENDING":"DELIVERED";
  localStorage.setItem("orders",JSON.stringify(orders));
  loadOrders();
}

// Export Excel
function exportExcel(){
  let orders=JSON.parse(localStorage.getItem("orders"))||[];
  let data=orders.map((o,i)=>({
    OrderID:i+1,
    Network:o.network,
    Phone:o.phone,
    Data:o.data,
    Status:o.status,
    Payment:o.payment,
    Date:o.date
  }));
  let ws=XLSX.utils.json_to_sheet(data);
  let wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Orders");
  XLSX.writeFile(wb,"Aspierrow_Orders.xlsx");
}

// Admin Price Control
function savePrices(){
  prices.MTN = Number(priceMTN.value);
  prices.Telecel = Number(priceTelecel.value);
  prices.AirtelTigo = Number(priceAirtelTigo.value);
  localStorage.setItem("dataPrices", JSON.stringify(prices));
  alert("Prices saved!");
}

// Logout
function logout(){location.reload();}
</script>

</body>
</html>
